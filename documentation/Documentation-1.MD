# Documentaci√≥n T√©cnica: Esquema de Base de Datos (`scheme.sql`)

## Descripci√≥n General

El archivo `scheme.sql` define la estructura de la base de datos para el sistema de inventario digital **Onoxfri**. El dise√±o est√° alineado con los requerimientos funcionales y no funcionales del sistema, garantizando seguridad, escalabilidad, trazabilidad y facilidad de uso.

La base de datos est√° organizada en cinco m√≥dulos principales:

1. **Autenticaci√≥n y Seguridad**
2. **Inventario Core**
3. **Precios y Promociones**
4. **Importaci√≥n y Exportaci√≥n**
5. **Reportes y M√©tricas (Dashboard)**

---

## 1. Autenticaci√≥n y Seguridad

- **users**: Almacena los usuarios del sistema, con contrase√±as cifradas.
- **roles**: Define los roles principales (Superusuario, Gerente, Asistente).
- **user_roles**: Relaciona usuarios con roles.
- **permissions**: Permisos granulares por funcionalidad.
- **role_permissions**: Relaciona roles con permisos.
- **user_sessions**: Historial de sesiones de usuario (inicio/cierre de sesi√≥n, IP, agente).
- **audit_logs**: Registro de acciones cr√≠ticas para auditor√≠a.

---

## 2. Inventario Core

- **products**: Productos del inventario, con campos clave como SKU, nombre, descripci√≥n, c√≥digo de barras, categor√≠a, precio, costo, stock m√≠nimo y estado.
- **categories**: Categor√≠as de productos.
- **stock_levels**: Niveles de stock por producto (cantidad disponible y reservada).
- **inventory_movements**: Movimientos de inventario (entradas, salidas, ajustes), con triggers para actualizar stock y generar alertas de stock bajo.
- **suppliers**: Proveedores asociados a los productos.
- **customers**: Clientes registrados.

---

## 3. Precios y Promociones

- **price_history**: Historial de cambios de precios por producto, con usuario responsable y motivo.
- **promotions**: Promociones aplicables a productos o categor√≠as, con tipo de descuento, vigencia, prioridad y usuario creador.

---

## 4. Importaci√≥n y Exportaci√≥n

- **import_jobs**: Registro de importaciones/exportaciones masivas, con tipo, archivo, estado y usuario responsable.
- **custom_transactions**: Transacciones personalizadas para operaciones especiales.

---

## 5. Reportes y M√©tricas (Dashboard)

- **Vistas**:
  - `v_inventory_value`: Valor total del inventario por producto.
  - `v_low_stock`: Productos con stock bajo.
  - `v_inventory_value_by_category`: Valor total del inventario agrupado por categor√≠a.
  - `v_stock_movements_by_period`: Movimientos de stock agrupados por periodo.

---

## Seguridad y Respaldo

- **backups**: Registro de respaldos autom√°ticos de la base de datos.

---

## √çndices y Rendimiento

- √çndices en campos clave para b√∫squedas r√°pidas (SKU, nombre, c√≥digo de barras, tipo de movimiento, fechas, etc.).
- Uso de claves for√°neas para integridad referencial.
- Soporte para escalabilidad y concurrencia.

---

## Notas T√©cnicas

- Todas las contrase√±as se almacenan cifradas.
- El sistema soporta auditor√≠a de acciones y sesiones.
- El dise√±o permite la importaci√≥n/exportaci√≥n eficiente de datos en formato Excel.
- El esquema est√° preparado para soportar al menos 10,000 productos activos y 10 usuarios concurrentes.
- Cumple con los principios DRY y KISS para facilitar el mantenimiento.

---

## Recomendaciones de Uso

- Realizar respaldos peri√≥dicos utilizando la tabla `backups`.
- Mantener actualizados los permisos y roles seg√∫n la evoluci√≥n de las funcionalidades.
- Utilizar las vistas para alimentar dashboards y reportes sin afectar el rendimiento de las tablas principales.

---

## Actualizaciones

Para modificar la estructura, se recomienda seguir las convenciones y agregar comentarios descriptivos en el SQL para facilitar futuras migraciones.

# Esquemas de Base de Datos - Sistema de Inventario Onoxfri

Este directorio contiene diferentes versiones del esquema de base de datos para facilitar la importaci√≥n en phpMyAdmin.

## üìÅ Archivos Disponibles

### 1. `scheme.sql` (Original)
- **Archivo original** con comentarios y metadatos de phpMyAdmin
- Incluye todos los elementos: tablas, vistas, triggers, √≠ndices, claves for√°neas
- **No recomendado** para pegar directamente en phpMyAdmin debido a comentarios

### 2. `scheme_clean.sql` (Limpio)
- Versi√≥n sin comentarios pero mantiene toda la funcionalidad
- Incluye triggers, vistas y procedimientos almacenados
- **Compatible** con phpMyAdmin pero puede requerir ejecuci√≥n por partes

### 3. `scheme_phpmyadmin.sql` (Optimizado para phpMyAdmin)
- Versi√≥n limpia sin comentarios ni elementos problem√°ticos
- Mantiene vistas y funcionalidades avanzadas
- **Recomendado** para importar en phpMyAdmin

### 4. `scheme_basic.sql` (B√°sico)
- **Solo tablas esenciales** sin triggers ni vistas complejas
- Excluye elementos que pueden causar problemas en phpMyAdmin
- **M√°s seguro** para entornos con restricciones

## üöÄ Recomendaciones de Uso

### Para phpMyAdmin (Recomendado):
```sql
-- Usa scheme_phpmyadmin.sql
-- Copia y pega todo el contenido directamente
```

### Para MySQL Workbench o l√≠nea de comandos:
```sql
-- Usa scheme.sql (original)
mysql -u usuario -p onoxfri < scheme.sql
```

### Para entornos con restricciones:
```sql
-- Usa scheme_basic.sql
-- Solo tablas b√°sicas sin elementos avanzados
```

## ‚ö†Ô∏è Notas Importantes

1. **Cambia las contrase√±as**: Los usuarios demo tienen contrase√±as hash que debes reemplazar
2. **Configura permisos**: Aseg√∫rate de que el usuario de MySQL tenga permisos adecuados
3. **Backup primero**: Siempre realiza un backup antes de importar esquemas

## üîß Soluci√≥n de Problemas

### Si phpMyAdmin muestra errores:
- Usa `scheme_basic.sql` (m√°s compatible)
- Ejecuta las instrucciones por secciones
- Verifica permisos del usuario MySQL

### Si faltan funcionalidades:
- Usa `scheme_phpmyadmin.sql` para funcionalidades completas
- Agrega manualmente triggers y vistas si es necesario

## üìã Funcionalidades Incluidas

### Todas las versiones incluyen:
- ‚úÖ Tablas b√°sicas (users, products, categories, etc.)
- ‚úÖ √çndices y claves for√°neas
- ‚úÖ Datos de demostraci√≥n
- ‚úÖ Relaciones entre tablas

### Versiones avanzadas agregan:
- ‚úÖ Triggers autom√°ticos de inventario
- ‚úÖ Vistas para reportes
- ‚úÖ Procedimientos almacenados
- ‚úÖ Sistema de permisos granular

## üéØ Versi√≥n Recomendada

Para la mayor√≠a de usuarios, recomiendo usar **`scheme_phpmyadmin.sql`** ya que:
- Est√° optimizado para phpMyAdmin
- Incluye todas las funcionalidades
- No tiene comentarios problem√°ticos
- Es f√°cil de copiar y pegar

## üîê Usuarios por Defecto

Despu√©s de importar, tendr√°s estos usuarios:
- **admin@example.com** - Superusuario (todos los permisos)
- **gerente@example.com** - Gerente (permisos de gesti√≥n)
- **asistente@example.com** - Asistente (permisos b√°sicos)

**Nota**: Cambia las contrase√±as despu√©s del primer inicio de sesi√≥n.